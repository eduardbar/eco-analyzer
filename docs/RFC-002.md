# RFC-002: Estrategia de Pruebas del Frontend

**Fecha:** 2025-08-06 **Autor:** Equipo de Frontend **Estado:** Propuesto

## 1. Resumen

Este RFC establece la estrategia y las herramientas para las pruebas del frontend de Next.js. El objetivo es garantizar la fiabilidad, corregir errores rápidamente y facilitar el refactoring seguro. Utilizaremos **Jest** como el ejecutor de pruebas y **React Testing Library (RTL)** para renderizar y interactuar con los componentes.

## 2. Tipos de Pruebas

Nos centraremos en dos niveles principales de pruebas:

- **Pruebas Unitarias:**
  - **Objetivo:** Probar pequeñas piezas de lógica de forma aislada.
  - **Ejemplos:** Funciones de utilidad (ej. formateo de números), hooks personalizados.
  - **Herramienta:** Jest.
- **Pruebas de Integración de Componentes:**
  - **Objetivo:** Probar cómo interactúan varios componentes entre sí, simulando el comportamiento del usuario. Este será nuestro enfoque principal.
  - **Ejemplos:**
    - Probar que al rellenar el `AnalysisForm` y hacer clic en el botón, se llama a la función `onSubmit`.
    - Probar que el componente `ResultDisplay` renderiza correctamente los datos recibidos en sus props.
    - Probar el flujo completo en `page.tsx`: el formulario se muestra, luego se oculta y aparecen los resultados después de una llamada a la API simulada.
  - **Herramienta:** Jest + React Testing Library.

## 3. Configuración

1. **Instalación de Dependencias:**

   ```
   npm install --save-dev jest jest-environment-jsdom @testing-library/react @testing-library/jest-dom
   ```

2. **Configuración de Jest (`jest.config.js`):** Se creará un archivo de configuración en la raíz del proyecto para indicarle a Jest cómo manejar los módulos de Next.js, TypeScript y CSS. Se utilizará el compilador SWC de Next.js para un rendimiento óptimo.

3. **Archivo de Setup (`jest.setup.js`):** Se creará un archivo para importar `jest-dom`, que nos proporciona matchers adicionales para las aserciones del DOM (ej. `toBeInTheDocument()`).

## 4. Estrategia de Pruebas por Componente

- **`AnalysisForm.tsx`:**
  - Debe renderizar un `textarea` y un `button`.
  - El usuario puede escribir en el `textarea`.
  - Al hacer clic en el botón, la función `onSubmit` pasada por props debe ser llamada con el texto del `textarea`.
  - Si el `textarea` está vacío, el `onSubmit` no debe ser llamado.
- **`ResultDisplay.tsx`:**
  - Debe renderizar el `EcoScore`, el título, y las métricas basadas en las props recibidas.
  - El color del `EcoScore` debe cambiar según su valor (verde > 75, amarillo > 50, rojo < 50). Se probará verificando la clase CSS aplicada.
- **`page.tsx` (Prueba de Integración Principal):**
  - **Estado Inicial:** La página debe mostrar el formulario de análisis.
  - **Flujo de Éxito:**
    1. Simular la escritura del usuario en el `textarea`.
    2. Simular el clic en el botón "Analizar".
    3. Verificar que se muestra el estado de carga.
    4. Simular una respuesta exitosa de la API (usando `jest.fn()` y `mockResolvedValue`).
    5. Verificar que el estado de carga desaparece y se muestra el componente `ResultDisplay` con los datos correctos.
  - **Flujo de Error:**
    1. Seguir los pasos 1 y 2.
    2. Simular una respuesta de error de la API (`mockRejectedValue`).
    3. Verificar que se muestra el componente `ErrorDisplay` con el mensaje de error apropiado.

## 5. Mocking

Las llamadas a la API (`fetch`) serán mockeadas usando `jest.fn()` para evitar realizar llamadas de red reales durante las pruebas. Esto nos da un control total sobre las respuestas (éxito, error, latencia) y hace que las pruebas sean rápidas y deterministas.